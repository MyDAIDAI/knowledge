(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{331:function(t,n,s){t.exports=s.p+"assets/img/image.be914693.png"},332:function(t,n,s){t.exports=s.p+"assets/img/image-1.f5ca6c19.png"},454:function(t,n,s){"use strict";s.r(n);var e=s(27),a=Object(e.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"react内部怎样遍历fiber树的呢"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react内部怎样遍历fiber树的呢"}},[t._v("#")]),t._v(" React内部怎样遍历"),n("code",[t._v("Fiber")]),t._v("树的呢？")]),t._v(" "),n("h2",{attrs:{id:"fiber树结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fiber树结构"}},[t._v("#")]),t._v(" "),n("code",[t._v("Fiber")]),t._v("树结构")]),t._v(" "),n("p",[t._v("在"),n("code",[t._v("React")]),t._v("内部的"),n("code",[t._v("Fiber")]),t._v("节点，主要有以下几个属性：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("child")]),t._v(": 指向当前节点的子节点")]),t._v(" "),n("li",[n("code",[t._v("sibling")]),t._v(": 指向当前节点的兄弟节点")]),t._v(" "),n("li",[n("code",[t._v("return")]),t._v(": 指向当前节点的父节点")])]),t._v(" "),n("p",[n("img",{attrs:{src:s(331),alt:"alt text"}})]),t._v(" "),n("p",[t._v("如上图的一个"),n("code",[t._v("Fiber Tree")]),t._v("，树结构内部依靠"),n("code",[t._v("child")]),t._v("、"),n("code",[t._v("sibling")]),t._v("以及"),n("code",[t._v("return")]),t._v("节点进行连接。那么怎么进行遍历呢？")]),t._v(" "),n("p",[t._v("在"),n("code",[t._v("react")]),t._v("内部是使用"),n("strong",[t._v("深度优先")]),t._v("的遍历方式，先从根节点依次向下走到最低层，然后找到最底层的兄弟节点，又依次向下走到最底层，按照这样的方式依次遍历完成整个数组。")]),t._v(" "),n("p",[t._v("我们可以将"),n("code",[t._v("react")]),t._v("中的遍历思想写成一个简单版本：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("begin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'begin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      nextNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("complete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("complete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'complete'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      nextNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    nextNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("begin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("将上面代码的执行过程图像化如下，分步进行执行过程分析：\n"),n("img",{attrs:{src:s(332),alt:"alt text"}})]),t._v(" "),n("ol",[n("li",[t._v("第一步，将开始节点"),n("code",[t._v("node1")]),t._v("赋值给全局变量"),n("code",[t._v("nextNode")]),t._v("，执行"),n("code",[t._v("begin")]),t._v("函数，打印 "),n("code",[t._v("begin 1")]),t._v("，判断"),n("code",[t._v("nextNode.child")]),t._v("存在，赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node2")])]),t._v(" "),n("li",[t._v("第二步，由于"),n("code",[t._v("nextNode")]),t._v("存在，继续执行"),n("code",[t._v("while")]),t._v("循环，打印 "),n("code",[t._v("begin 2")]),t._v("，判断"),n("code",[t._v("nextNode.child")]),t._v("存在，赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node3")])]),t._v(" "),n("li",[t._v("第三步，由于"),n("code",[t._v("nextNode")]),t._v("存在，继续执行"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("begin 3")]),t._v("，此时"),n("code",[t._v("nextNode === node3")]),t._v("，判断"),n("code",[t._v("nexNode.child")]),t._v("不存在，进入"),n("code",[t._v("complete")]),t._v("函数，执行"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 3")])]),t._v(" "),n("li",[t._v("第四步，，判断"),n("code",[t._v("nextNode.sibling")]),t._v("存在，赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node4")]),t._v("，并执行"),n("code",[t._v("return")]),t._v("，返回到"),n("code",[t._v("begin()")]),t._v("函数中，继续在"),n("code",[t._v("begin()")]),t._v("函数中执行"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("begin 4")])]),t._v(" "),n("li",[t._v("第五步，此时"),n("code",[t._v("nextNode === node4")]),t._v("，判断"),n("code",[t._v("nextNode.child")]),t._v("是否存在，赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node6")]),t._v("，再次进入"),n("code",[t._v("begin()")]),t._v("函数中的"),n("code",[t._v("while")]),t._v("循坏，打印"),n("code",[t._v("begin 6")])]),t._v(" "),n("li",[t._v("第六步，此时"),n("code",[t._v("nextNode === node6")]),t._v("，判断"),n("code",[t._v("nextNode.child")]),t._v("是否存在，不存在，进入"),n("code",[t._v("complete")]),t._v("函数，进入"),n("code",[t._v("complete")]),t._v("中的"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 6")])]),t._v(" "),n("li",[t._v("第七步，，判断"),n("code",[t._v("nextNode.sibling")]),t._v("存在，赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node7")]),t._v("，并执行"),n("code",[t._v("return")]),t._v("，返回到"),n("code",[t._v("begin()")]),t._v("函数中，继续在"),n("code",[t._v("begin()")]),t._v("函数中执行"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("begin 7")])]),t._v(" "),n("li",[t._v("第八步，此时"),n("code",[t._v("nextNode === node7")]),t._v("，判断"),n("code",[t._v("nextNode.child")]),t._v("是否存在，赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node8")]),t._v("，再次进入"),n("code",[t._v("begin()")]),t._v("函数中的"),n("code",[t._v("while")]),t._v("循坏，打印"),n("code",[t._v("begin 8")])]),t._v(" "),n("li",[t._v("第九步，此时"),n("code",[t._v("nextNode === node8")]),t._v("，判断"),n("code",[t._v("nextNode.child")]),t._v("是否存在，不存在，进入"),n("code",[t._v("complete")]),t._v("函数，进入"),n("code",[t._v("complete")]),t._v("中的"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 8")])]),t._v(" "),n("li",[t._v("第十步，，判断"),n("code",[t._v("nextNode.sibling")]),t._v("存在，不存在，则将"),n("code",[t._v("nextNode.return")]),t._v("赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node7")]),t._v("，继续执行"),n("code",[t._v("complete")]),t._v("函数中的"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 7")])]),t._v(" "),n("li",[t._v("第十一步，判断"),n("code",[t._v("nextNode.sibling")]),t._v("不存在，继续将"),n("code",[t._v("nextNode.return")]),t._v("赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node4")]),t._v("，继续执行"),n("code",[t._v("complete")]),t._v("函数中的"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 4")])]),t._v(" "),n("li",[t._v("第十二步，判断"),n("code",[t._v("nextNode.sibling")]),t._v("存在，则将其赋值给"),n("code",[t._v("nextNode")]),t._v("，此时"),n("code",[t._v("nextNode === node5")]),t._v("，执行"),n("code",[t._v("return")]),t._v("，返回到"),n("code",[t._v("begin")]),t._v("函数中，进入"),n("code",[t._v("begin")]),t._v("函数中执行"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("begin 5")])]),t._v(" "),n("li",[t._v("第十三步，判断"),n("code",[t._v("nextNode.child")]),t._v("不存在，执行"),n("code",[t._v("complete")]),t._v("函数，进入"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 5")])]),t._v(" "),n("li",[t._v("第十四步，判断"),n("code",[t._v("nextNode.sibling")]),t._v("不存在，将"),n("code",[t._v("nextNode.return")]),t._v("赋值给"),n("code",[t._v("nextNode")]),t._v("，继续执行"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 2")])]),t._v(" "),n("li",[t._v("第十五步，判断"),n("code",[t._v("nextNode.sibling")]),t._v("不存在，将"),n("code",[t._v("nextNode.return")]),t._v("赋值给"),n("code",[t._v("nextNode")]),t._v("，继续执行"),n("code",[t._v("while")]),t._v("循环，打印"),n("code",[t._v("complete 1")])])]),t._v(" "),n("p",[t._v("所以上面的代码会打印下面信息：")]),t._v(" "),n("div",{staticClass:"language-text extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("begin 1\nbegin 2\nbegin 3\ncomplete 3\nbegin 4\nbegin 6\ncomplete 6\nbegin 7\nbegin 8\ncomplete 8\ncomplete 7\ncomplee 4\nbegin 5\ncomplete 5\ncomplete 2\ncomplete 1\n\n")])])]),n("p",[t._v("下面是"),n("code",[t._v("ReactV18")]),t._v("中关于"),n("code",[t._v("Fiber")]),t._v("树遍历相关的代码")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitPassiveMountEffects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" finishedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedTransitions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" finishedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitPassiveMountEffects_begin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("finishedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedTransitions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitPassiveMountEffects_begin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("subtreeRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedTransitions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" firstChild "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subtreeFlags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" PassiveMask"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" NoFlags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" firstChild "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        firstChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" firstChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitPassiveMountEffects_complete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("subtreeRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedTransitions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitPassiveMountEffects_complete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("subtreeRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedTransitions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Passive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" NoFlags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCurrentFiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitPassiveMountOnFiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" committedTransitions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("captureCommitPhaseError")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resetCurrentFiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" subtreeRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" sibling "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sibling "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("可以看到其核心是一致的。")])])}),[],!1,null,null,null);n.default=a.exports}}]);