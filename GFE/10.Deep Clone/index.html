<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deep Clone | 邓攀的技术博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge/assets/css/0.styles.ef1330c5.css" as="style"><link rel="preload" href="/knowledge/assets/js/app.d13ce116.js" as="script"><link rel="preload" href="/knowledge/assets/js/2.bc15d414.js" as="script"><link rel="preload" href="/knowledge/assets/js/1.6c0ff8f4.js" as="script"><link rel="preload" href="/knowledge/assets/js/52.2b8cd451.js" as="script"><link rel="prefetch" href="/knowledge/assets/js/10.e193d6c0.js"><link rel="prefetch" href="/knowledge/assets/js/11.8e802c1e.js"><link rel="prefetch" href="/knowledge/assets/js/12.65553447.js"><link rel="prefetch" href="/knowledge/assets/js/13.2be48d38.js"><link rel="prefetch" href="/knowledge/assets/js/14.fbcaafc6.js"><link rel="prefetch" href="/knowledge/assets/js/15.e40ead57.js"><link rel="prefetch" href="/knowledge/assets/js/16.49184ae1.js"><link rel="prefetch" href="/knowledge/assets/js/17.dc3323dd.js"><link rel="prefetch" href="/knowledge/assets/js/18.648b10c4.js"><link rel="prefetch" href="/knowledge/assets/js/19.2a696a53.js"><link rel="prefetch" href="/knowledge/assets/js/20.89f58454.js"><link rel="prefetch" href="/knowledge/assets/js/21.0e698439.js"><link rel="prefetch" href="/knowledge/assets/js/22.2951858e.js"><link rel="prefetch" href="/knowledge/assets/js/23.fad55543.js"><link rel="prefetch" href="/knowledge/assets/js/24.1811a1e3.js"><link rel="prefetch" href="/knowledge/assets/js/25.7d611585.js"><link rel="prefetch" href="/knowledge/assets/js/26.2706e843.js"><link rel="prefetch" href="/knowledge/assets/js/27.2ffa03e5.js"><link rel="prefetch" href="/knowledge/assets/js/28.2e367c11.js"><link rel="prefetch" href="/knowledge/assets/js/29.cb85613d.js"><link rel="prefetch" href="/knowledge/assets/js/3.f74b7660.js"><link rel="prefetch" href="/knowledge/assets/js/30.652b9bc5.js"><link rel="prefetch" href="/knowledge/assets/js/31.e2d5d8ed.js"><link rel="prefetch" href="/knowledge/assets/js/32.2097c650.js"><link rel="prefetch" href="/knowledge/assets/js/33.c3b9402b.js"><link rel="prefetch" href="/knowledge/assets/js/34.9690a5a6.js"><link rel="prefetch" href="/knowledge/assets/js/35.a3e2d1a4.js"><link rel="prefetch" href="/knowledge/assets/js/36.40ee0a89.js"><link rel="prefetch" href="/knowledge/assets/js/37.e5c4e5c6.js"><link rel="prefetch" href="/knowledge/assets/js/38.3da1edcd.js"><link rel="prefetch" href="/knowledge/assets/js/39.dde21d94.js"><link rel="prefetch" href="/knowledge/assets/js/4.d0407187.js"><link rel="prefetch" href="/knowledge/assets/js/40.183865a3.js"><link rel="prefetch" href="/knowledge/assets/js/41.fbed79bd.js"><link rel="prefetch" href="/knowledge/assets/js/42.ddb9e519.js"><link rel="prefetch" href="/knowledge/assets/js/43.d8c6b670.js"><link rel="prefetch" href="/knowledge/assets/js/44.b8600c23.js"><link rel="prefetch" href="/knowledge/assets/js/45.8fdbb89e.js"><link rel="prefetch" href="/knowledge/assets/js/46.2c0b6696.js"><link rel="prefetch" href="/knowledge/assets/js/47.ba0b752b.js"><link rel="prefetch" href="/knowledge/assets/js/48.77af7173.js"><link rel="prefetch" href="/knowledge/assets/js/49.4165aa91.js"><link rel="prefetch" href="/knowledge/assets/js/5.6b5b30dd.js"><link rel="prefetch" href="/knowledge/assets/js/50.02a683f2.js"><link rel="prefetch" href="/knowledge/assets/js/51.377c538d.js"><link rel="prefetch" href="/knowledge/assets/js/53.b6fbea0a.js"><link rel="prefetch" href="/knowledge/assets/js/54.465ac807.js"><link rel="prefetch" href="/knowledge/assets/js/55.0dbe2c3d.js"><link rel="prefetch" href="/knowledge/assets/js/56.58d40823.js"><link rel="prefetch" href="/knowledge/assets/js/57.cd68dd2d.js"><link rel="prefetch" href="/knowledge/assets/js/58.ab749b89.js"><link rel="prefetch" href="/knowledge/assets/js/59.d290e425.js"><link rel="prefetch" href="/knowledge/assets/js/6.ded172f2.js"><link rel="prefetch" href="/knowledge/assets/js/60.3c53fd43.js"><link rel="prefetch" href="/knowledge/assets/js/61.5f83939f.js"><link rel="prefetch" href="/knowledge/assets/js/62.73a942e4.js"><link rel="prefetch" href="/knowledge/assets/js/63.0838cf95.js"><link rel="prefetch" href="/knowledge/assets/js/64.d3240197.js"><link rel="prefetch" href="/knowledge/assets/js/65.80115882.js"><link rel="prefetch" href="/knowledge/assets/js/66.b3f1a356.js"><link rel="prefetch" href="/knowledge/assets/js/67.19eee347.js"><link rel="prefetch" href="/knowledge/assets/js/68.8be7df47.js"><link rel="prefetch" href="/knowledge/assets/js/69.20fbf51a.js"><link rel="prefetch" href="/knowledge/assets/js/7.48ee682d.js"><link rel="prefetch" href="/knowledge/assets/js/70.be66b6a3.js"><link rel="prefetch" href="/knowledge/assets/js/71.1cb926bc.js"><link rel="prefetch" href="/knowledge/assets/js/72.a00945dc.js"><link rel="prefetch" href="/knowledge/assets/js/73.a2552003.js"><link rel="prefetch" href="/knowledge/assets/js/74.cbe8f2ff.js"><link rel="prefetch" href="/knowledge/assets/js/75.0d9796c1.js"><link rel="prefetch" href="/knowledge/assets/js/76.81666afa.js"><link rel="prefetch" href="/knowledge/assets/js/77.c982ce9e.js"><link rel="prefetch" href="/knowledge/assets/js/78.cdad9a20.js"><link rel="prefetch" href="/knowledge/assets/js/79.f5c2f5e9.js"><link rel="prefetch" href="/knowledge/assets/js/80.f34dff30.js"><link rel="prefetch" href="/knowledge/assets/js/81.a63fca8d.js"><link rel="prefetch" href="/knowledge/assets/js/vendors~docsearch.94b65286.js">
    <link rel="stylesheet" href="/knowledge/assets/css/0.styles.ef1330c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge/" class="home-link router-link-active"><!----> <span class="site-name">邓攀的技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/MyDAIDAI" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/MyDAIDAI" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/knowledge/" aria-current="page" class="sidebar-link">欢迎</a></li><li><section class="sidebar-group depth-0"><a href="/knowledge/vue" class="sidebar-heading clickable"><span>Vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/vue/响应式.html" class="sidebar-link">响应式</a></li><li><a href="/knowledge/vue/编译.html" class="sidebar-link">编译</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/react" class="sidebar-heading clickable"><span>React</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/react/JSX.html" class="sidebar-link">JSX</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/typescript" class="sidebar-heading clickable"><span>TypeScript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/typescript/type-challenges.html" class="sidebar-link">类型体操</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/nextjs" class="sidebar-heading clickable"><span>nextjs</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/nextjs/docs.html" class="sidebar-link">文档</a></li><li><a href="/knowledge/nextjs/use.html" class="sidebar-link">使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/algorithm" class="sidebar-heading clickable"><span>算法</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/algorithm/二分查找.html" class="sidebar-link">二分查找</a></li><li><a href="/knowledge/algorithm/大数相加.html" class="sidebar-link">大数相加</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/system-design" class="sidebar-heading clickable"><span>系统设计</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/system-design/news-feed.html" class="sidebar-link">news feed</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/interview" class="sidebar-heading clickable"><span>面试相关</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/interview/html.html" class="sidebar-link">HTML</a></li><li><a href="/knowledge/interview/JavaScript.html" class="sidebar-link">JavaScript</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/GFE" class="sidebar-heading clickable router-link-active open"><span>GFE</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/GFE/01.debounce/" class="sidebar-link">Debounce</a></li><li><a href="/knowledge/GFE/02.myReduce/" class="sidebar-link">MyReduce</a></li><li><a href="/knowledge/GFE/03.classnames/" class="sidebar-link">ClassNames</a></li><li><a href="/knowledge/GFE/04.flatten/" class="sidebar-link">Flatten</a></li><li><a href="/knowledge/GFE/05.throttle/" class="sidebar-link">Throttle</a></li><li><a href="/knowledge/GFE/06.Type%20Utilities/" class="sidebar-link">Type Utilities</a></li><li><a href="/knowledge/GFE/07.Type%20Utilities%20II/" class="sidebar-link">Type Utilities II</a></li><li><a href="/knowledge/GFE/08.Promise.all/" class="sidebar-link">Promise.all</a></li><li><a href="/knowledge/GFE/09.Data%20Merging/" class="sidebar-link">Data Merging</a></li><li><a href="/knowledge/GFE/10.Deep%20Clone/" aria-current="page" class="active sidebar-link">Deep Clone</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/GFE/10.Deep%20Clone/#solution" class="sidebar-link">Solution</a></li><li class="sidebar-sub-header"><a href="/knowledge/GFE/10.Deep%20Clone/#more" class="sidebar-link">More</a></li></ul></li><li><a href="/knowledge/GFE/11.Event%20Emitter/" class="sidebar-link">Event Emitter</a></li><li><a href="/knowledge/GFE/12.getElementsByStyle/" class="sidebar-link">getElementsByStyle</a></li><li><a href="/knowledge/GFE/13.Function.prototype.call/" class="sidebar-link">Function.prototype.call</a></li><li><a href="/knowledge/GFE/14.List%20Format/" class="sidebar-link">List Format</a></li><li><a href="/knowledge/GFE/15.Map%20Async%20Limit/" class="sidebar-link">Map Async Limit</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/Blind" class="sidebar-heading clickable"><span>Blind</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/Blind/01.Balanced%20Brackets/" class="sidebar-link">Balanced Brackets</a></li><li><a href="/knowledge/Blind/02.Find%20Duplicates%20in%20Array/" class="sidebar-link">Find Duplicates in Array</a></li><li><a href="/knowledge/Blind/03.Find%20Missing%20Number%20in%20Sequence/" class="sidebar-link">Find Missing Number in Sequence</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge/git" class="sidebar-heading clickable"><span>Git</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/git/commit.html" class="sidebar-link">commit</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deep-clone"><a href="#deep-clone" class="header-anchor">#</a> Deep Clone</h1> <p>实现一个深拷贝函数，只考虑实现使用<code>JSON.stringify</code>可以进行序列化的数据类型，如<code>null</code>, <code>boolean</code>, <code>number</code>, <code>string</code>, <code>Array</code>, <code>Object</code>，不用包含其他比如<code>Date</code>, <code>Regex</code>, <code>Map</code> or <code>Set</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> user<span class="token operator">:</span> <span class="token punctuation">{</span> role<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> clonedObj1 <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>

clonedObj1<span class="token punctuation">.</span>user<span class="token punctuation">.</span>role <span class="token operator">=</span> <span class="token string">'guest'</span><span class="token punctuation">;</span> <span class="token comment">// Change the cloned user's role to 'guest'.</span>
clonedObj1<span class="token punctuation">.</span>user<span class="token punctuation">.</span>role<span class="token punctuation">;</span> <span class="token comment">// 'guest'</span>
obj1<span class="token punctuation">.</span>user<span class="token punctuation">.</span>role<span class="token punctuation">;</span> <span class="token comment">// Should still be 'admin'.</span>

<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> bar<span class="token operator">:</span> <span class="token string">'baz'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> clonedObj2 <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>

obj2<span class="token punctuation">.</span>foo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token string">'bax'</span><span class="token punctuation">;</span> <span class="token comment">// Modify the original object.</span>
obj2<span class="token punctuation">.</span>foo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bar<span class="token punctuation">;</span> <span class="token comment">// 'bax'</span>
clonedObj2<span class="token punctuation">.</span>foo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bar<span class="token punctuation">;</span> <span class="token comment">// Should still be 'baz'.</span>
</code></pre></div><h2 id="solution"><a href="#solution" class="header-anchor">#</a> Solution</h2> <p>这个解决办法比较简单，比较快的方式就是通过<code>JSON.stringify</code>，第二种方式就是对数据进行递归，每次遇到数组或者对象，则创建新对象，并且进行递归赋值</p> <h3 id="json-stringify"><a href="#json-stringify" class="header-anchor">#</a> <code>JSON.stringify</code></h3> <p>使用<code>JSON</code>虽然比较快也比较方便，但是会有一些缺陷</p> <ul><li>递归数据结构：当您向 JSON.stringify() 提供递归数据结构时，它会抛出异常。在使用链表或树时，这种情况很容易发生。</li> <li>内置类型：如果值包含其他 JS 内置类型（例如 Map、Set、Date、RegExp 或 ArrayBuffer），JSON.stringify() 将抛出异常。</li> <li>函数：JSON.stringify() 会静默舍弃函数。</li></ul> <p>方法1：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">deepClone</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj <span class="token operator">||</span> <span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>i <span class="token keyword">as</span> <span class="token builtin">unknown</span> <span class="token keyword">as</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方法2：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">deepClone</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">'object'</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li><p><code>Object.fromEntries()</code> 静态方法将键值对列表转换为一个对象。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> entries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;baz&quot;</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Expected output: Object { foo: &quot;bar&quot;, baz: 42 }</span>
</code></pre></div></li></ul> <h2 id="more"><a href="#more" class="header-anchor">#</a> More</h2> <p>浏览器修改了 HTML 规范，以公开一个名为 structuredClone() 的函数，该函数会精确运行该算法，以便开发者轻松创建 JavaScript 值的深层副本。<code>const myDeepCopy = structuredClone(myOriginal);</code></p> <p>功能和限制结构化克隆解决了 <code>JSON.stringify()</code> 技术的许多（但不是全部）缺点。结构化克隆可以处理周期性数据结构，支持许多内置数据类型，通常更稳健且速度更快。</p> <p>不过，它仍然存在一些可能会让您措手不及的限制：</p> <ul><li>原型：如果您将 structuredClone() 与类实例搭配使用，则会将普通对象作为返回值，因为结构化克隆会舍弃对象的原型链。</li> <li>函数：如果您的对象包含函数，structuredClone() 将抛出 DataCloneError 异常。</li> <li>不可克隆：某些值不是结构化可克隆的，最值得注意的是 Error 和 DOM 节点。这会导致 structuredClone() 抛出异常。</li></ul> <p>如果上述任何限制对您的用例来说都是致命的，Lodash 等库仍可提供其他深度克隆算法的自定义实现，这些实现可能或可能不适合您的用例。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge/assets/js/app.d13ce116.js" defer></script><script src="/knowledge/assets/js/2.bc15d414.js" defer></script><script src="/knowledge/assets/js/1.6c0ff8f4.js" defer></script><script src="/knowledge/assets/js/52.2b8cd451.js" defer></script>
  </body>
</html>
